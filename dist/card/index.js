'use strict';var _toConsumableArray2=require('babel-runtime/helpers/toConsumableArray'),_toConsumableArray3=_interopRequireDefault(_toConsumableArray2),_promise=require('babel-runtime/core-js/promise'),_promise2=_interopRequireDefault(_promise),_assign=require('babel-runtime/core-js/object/assign'),_assign2=_interopRequireDefault(_assign),_classCallCheck2=require('babel-runtime/helpers/classCallCheck'),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require('babel-runtime/helpers/createClass'),_createClass3=_interopRequireDefault(_createClass2),_index=require('../index.js'),_comm=require('../comm.js');Object.defineProperty(exports,'__esModule',{value:!0}),exports.CardBoard=void 0;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var CardBoard=exports.CardBoard=function(){function a(){(0,_classCallCheck3.default)(this,a),this.DOC=document,this.DEVICE_HEIGHT=this.DOC.documentElement.clientHeight||this.DOC.body.clientHeight,this.cardBoardContainer={},this.cardBoards=[],this.default={},this.setting={},this.init=this.init.bind(this),this.pinCardBoard=this.pinCardBoard.bind(this),this.scrollHandler=this.scrollHandler.bind(this),this.setCardEFStyle=this.setCardEFStyle.bind(this),this.removeCardEFStyle=this.removeCardEFStyle.bind(this),this.destroy=this.destroy.bind(this)}return(0,_createClass3.default)(a,[{key:'init',value:function init(b){var d=b.container,e=void 0===d?'body':d,f=b.option;return this.cardBoardContainer=this.DOC.querySelector(e),this.default={cardBoardContainer:'.cardBoard',lastCardTransparent:!1},this.setting=(0,_assign2.default)({},this.default,f),_promise2.default.all([this.pinCardBoard()])}},{key:'destroy',value:function destroy(){window.removeEventListener('scroll',this.scrollHandler),this.cardBoardContainer={},this.cardBoards=[],this.default={},this.setting={}}},{key:'pinCardBoard',value:function pinCardBoard(){var b=this;return new _promise2.default(function(d){var e=[].concat((0,_toConsumableArray3.default)(b.cardBoardContainer.querySelectorAll(b.setting.cardBoardContainer)));e&&0<e.length&&(e.map(function(f,g){var h='.'+f.getAttribute('class').split(' ').join('.')+'.KCCB-'+g;(0,_comm.addClass)(f,'KCCB-'+g);var j=(0,_index.elmYPosition)(h),k=f.getAttribute('style'),l=k?k+'; height:'+f.clientHeight+'px; z-index: 102;':'height:'+f.clientHeight+'px; z-index: 102;';f.setAttribute('style',l),b.cardBoards.push({id:h,ele:f,eleTopY:j,eleBtmY:j+f.clientHeight,cardOStyle:l})}),window.addEventListener('scroll',b.scrollHandler)),d()})}},{key:'scrollHandler',value:function scrollHandler(){var b=this,d=(0,_index.currentYPosition)(),e=d+this.DEVICE_HEIGHT;this.cardBoards.map(function(f){f.eleBtmY<e&&f.eleBtmY>d?(b.setting.lastCardTransparent&&f.ele.setAttribute('style',f.cardOStyle+' opacity: '+(f.eleBtmY-d)/b.DEVICE_HEIGHT+';'),b.setCardEFStyle({id:f.id,ele:f.ele,eleBtmY:f.eleBtmY,currTopY:d})):(f.eleBtmY>=e?b.setting.lastCardTransparent&&f.ele.setAttribute('style',f.cardOStyle):b.setting.lastCardTransparent&&f.ele.setAttribute('style',f.cardOStyle+' opacity: 0;'),b.removeCardEFStyle({id:f.id,ele:f.ele}))})}},{key:'setCardEFStyle',value:function setCardEFStyle(b){var d=b.id,e=b.ele,f=b.eleBtmY,g=b.currTopY;return new _promise2.default(function(h){var j=[].concat((0,_toConsumableArray3.default)(e.children));j&&0<j.length&&(j.map(function(k){var l=k.getAttribute('class'),m=k.getAttribute('style'),n=k.offsetLeft,o=k.clientWidth;k.setAttribute('style','position: relative;'+(-1<l.indexOf('brief')?'z-index: 100 !important;':''));var p=(0,_index.elmYPosition)(d+' .'+l.split(' ').join('.')),q='position: fixed; bottom: '+(f-(p+k.clientHeight))+'px;\n                          left: '+n+'px; z-index: 99; width: '+o+'px; padding-top: 1px;',r=k.getAttribute('style');k.setAttribute('a-style',q),k.setAttribute('o-style',r)}),j.map(function(k){var l=k.getAttribute('a-style'),m=k.getAttribute('o-style');k.setAttribute('style',''+m+l)})),h()})}},{key:'removeCardEFStyle',value:function removeCardEFStyle(b){var d=b.id,e=b.ele;return new _promise2.default(function(f){var g=[].concat((0,_toConsumableArray3.default)(e.children));g&&0<g.length&&g.map(function(h){var j=h.getAttribute('o-style')||h.getAttribute('style')||'';h.setAttribute('style',j)}),f()})}}]),a}();